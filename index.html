<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Pokémon GO 44/45 IV (Raid L20/L25) Search Generator</title>
  <meta name="description" content="Generate in‑game search strings to find 44/45 IV (97.8%) raid catches by CP for Level 20 and Level 25 using live data from Pokémon GO Hub (db.pokemongohub.net)." />
  <style>
    :root {
      --bg: #0f1220; --panel:#161a2a; --soft:#20263f; --txt:#e7ebff; --muted:#a9b3d9; --acc:#7aa2ff; --good:#4ade80; --warn:#facc15; --bad:#fb7185;
    }
    * { box-sizing: border-box; }
    html, body { margin:0; height:100%; font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji"; background:linear-gradient(180deg, #0b0f1c 0%, #0f1220 40%, #0f1220 100%); color:var(--txt); }
    a { color: var(--acc); }
    .wrap { max-width: 880px; margin: 40px auto; padding: 0 16px; }
    .card { background:linear-gradient(180deg, var(--panel), #121626); border:1px solid #1f2440; border-radius: 16px; box-shadow: 0 10px 30px rgba(0,0,0,.25); padding: 18px; }
    h1 { font-size: 22px; margin: 0 0 8px; letter-spacing:.2px; }
    p { color: var(--muted); margin: 4px 0 12px; }
    .grid { display:grid; grid-template-columns: 1fr; gap: 12px; }
    @media (min-width: 720px){ .grid{ grid-template-columns: 1.2fr 1fr; } }
    label { font-size: 13px; color: var(--muted); display:block; margin-bottom:6px; }
    input[type="text"] { width:100%; background:#0d1120; border:1px solid #263056; color:var(--txt); border-radius: 12px; padding:12px 12px; outline:none; }
    input[type="text"]:focus { border-color: var(--acc); box-shadow: 0 0 0 3px rgba(122,162,255,.15); }
    .row { display:flex; gap: 12px; align-items:center; flex-wrap: wrap; }
    .btn { appearance: none; background: linear-gradient(180deg, #2a3568, #1e274e); color:white; border:1px solid #2f3a70; padding: 10px 14px; border-radius: 12px; cursor: pointer; font-weight: 600; }
    .btn:disabled { opacity:.4; cursor:not-allowed; }
    .btn.alt { background: linear-gradient(180deg, #214c3a, #173a2b); border-color:#1e513d; }
    .btn.ghost { background: transparent; border-color:#35406d; }
    .tiny { font-size: 12px; color: var(--muted); }
    .tag { display:inline-flex; align-items:center; gap:6px; border:1px solid #2c365f; background:#10162a; padding:6px 10px; border-radius:999px; font-size:12px; color:var(--muted); }
    .out { width:100%; min-height: 92px; background:#0d1120; border:1px dashed #37406b; color:#cfe0ff; border-radius:12px; padding:12px; white-space: pre-wrap; }
    .mono { font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace; font-size: 13px; }
    .pill { padding: 6px 10px; border-radius: 999px; border:1px solid #303a66; background:#0f1426; color:var(--muted); }
    .status { margin-top: 8px; font-size: 12px; color:var(--muted); }
    .tbl { width:100%; border-collapse: collapse; margin-top: 8px; }
    .tbl th, .tbl td { border-bottom:1px solid #232b4b; padding: 8px 6px; text-align:left; }
    .tbl th { color:#9fb0e8; font-weight:600; font-size:12px; }
    .tbl td { font-size:13px; color:#dbe4ff; }
    .muted { color: var(--muted); }
    .warn { color: var(--warn); }
    .ok { color: var(--good); }
    .err { color: var(--bad); }
    details { border:1px solid #263056; background:#0d1120; border-radius: 12px; padding: 10px 12px; }
    summary { cursor: pointer; font-weight:600; }
    footer { margin: 24px 0 40px; color:var(--muted); font-size:12px; text-align:center; }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <h1>Pokémon GO 44/45 IV (97.8%) Raid Search Generator</h1>
      <p>Build an in‑game search string that finds <strong>44/45 IV</strong> raid catches by <strong>CP</strong> at <strong>Level 20</strong> (no weather) and <strong>Level 25</strong> (weather‑boosted). Data are pulled from <strong>Pokémon GO Hub</strong> where possible.</p>
      <div class="grid">
        <div>
          <label>Species text for in‑game search (optional but recommended)
            <span class="tiny">e.g. <code class="mono">zacian</code>, <code class="mono">mewtwo</code></span>
          </label>
          <input id="species" type="text" placeholder="zacian" />
        </div>
        <div>
          <label>GO Hub slug or Pokédex ID (form aware)
            <span class="tiny">e.g. <code class="mono">888-Hero</code>, <code class="mono">888-Crowned_Sword</code>, <code class="mono">150</code></span>
          </label>
          <input id="slug" type="text" placeholder="888-Hero" />
        </div>
      </div>
      <div class="row" style="margin-top:12px">
        <label class="tag"><input type="checkbox" id="inc20" checked> include L20 (no weather)</label>
        <label class="tag"><input type="checkbox" id="inc25" checked> include L25 (weather boost)</label>
        <label class="tag"><input type="checkbox" id="dupPrefix" checked> prefix each OR with species & <code class="mono">israid</code></label>
        <span class="pill">Tip: if form is unknown, try IDs like <span class="mono">150</span>, <span class="mono">150-Shadow</span>, <span class="mono">648-Aria</span>, <span class="mono">641-Therian</span>.</span>
      </div>
      <div class="row" style="margin-top:8px">
        <button id="go" class="btn">Generate</button>
        <button id="copy" class="btn ghost" disabled>Copy</button>
        <a id="srcLink" href="#" class="btn alt" target="_blank" rel="noopener">Open GO Hub source</a>
      </div>
      <div id="status" class="status">Ready. Example: set <span class="mono">species</span> to <span class="mono">zacian</span>, <span class="mono">slug</span> to <span class="mono">888-Hero</span>.</div>

      <h3 style="margin:16px 0 8px">Output</h3>
      <textarea id="out" class="out mono" placeholder="Your search string will appear here…" readonly></textarea>

      <table class="tbl" id="cpTable" style="display:none">
        <thead>
          <tr>
            <th>IVs</th>
            <th class="muted">Filter bits</th>
            <th>L20 CP (Raid/Egg)</th>
            <th>L25 CP (Weather)</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>

      <details style="margin-top:14px">
        <summary>⚠️ Having trouble (CORS)? Use manual paste fallback</summary>
        <p>Some browsers or hosts may block cross‑site requests. As a fallback, open the Pokémon’s <em>CP & IV Chart</em> page on GO Hub, copy the whole page source (<kbd>Ctrl/Cmd</kbd> + <kbd>A</kbd>, then <kbd>Ctrl/Cmd</kbd> + <kbd>C</kbd>) and paste below, then press <strong>Parse pasted HTML</strong>.</p>
        <textarea id="paste" class="out mono" placeholder="Paste the HTML of https://db.pokemongohub.net/pokemon/&lt;slug&gt;/iv-chart here…"></textarea>
        <div class="row" style="margin-top:8px">
          <button id="parse" class="btn">Parse pasted HTML</button>
          <span class="tiny">Only the three 97.8% rows are parsed to get L20/L25 CP values.</span>
        </div>
      </details>
    </div>

    <footer>
      Built for trainers. Not affiliated with Niantic, Nintendo, or The Pokémon Company. Data courtesy of <a href="https://db.pokemongohub.net/" target="_blank" rel="noopener">Pokémon GO Hub</a>.
    </footer>
  </div>

  <script>
  const $ = sel => document.querySelector(sel);
  const speciesEl = $('#species');
  const slugEl = $('#slug');
  const inc20El = $('#inc20');
  const inc25El = $('#inc25');
  const dupPrefixEl = $('#dupPrefix');
  const outEl = $('#out');
  const tbl = $('#cpTable');
  const tbody = tbl.querySelector('tbody');
  const statusEl = $('#status');
  const srcLink = $('#srcLink');

  const COMMON_FORMS = ["", "-Normal", "-Hero", "-Crowned_Sword", "-Shadow", "-Alola", "-Galar", "-Hisuian", "-Incarnate", "-Therian", "-Aria", "-Pirouette", "-Altered", "-Origin", "-Sky", "-Land", "-Trash", "-Sandy", "-Plant"];

  function buildSourceUrl(slug){
    return `https://db.pokemongohub.net/pokemon/${encodeURIComponent(slug)}/iv-chart`;
  }

  function prettyBits([a,d,s]){
    // Map which stat is 14 to 4* bits
    if(a===14 && d===15 && s===15) return '4defense&4hp';
    if(a===15 && d===14 && s===15) return '4attack&4hp';
    if(a===15 && d===15 && s===14) return '4attack&4defense';
    return '';
  }

  function genSegments(rows, species, include20, include25, dupPrefix){
    const pieces = [];
    rows.forEach(r => {
      const bits = prettyBits(r.ivs);
      if(include20 && r.cp20){
        const seg = `${species? species+"&" : ''}israid&cp${r.cp20}&${bits}`;
        pieces.push(dupPrefix? seg : `cp${r.cp20}&${bits}`);
      }
      if(include25 && r.cp25){
        const seg = `${species? species+"&" : ''}israid&cp${r.cp25}&${bits}`;
        pieces.push(dupPrefix? seg : `cp${r.cp25}&${bits}`);
      }
    });
    // Commas are ORs in Pokémon GO search
    return pieces.join(',');
  }

  function renderTable(rows){
    tbody.innerHTML='';
    rows.forEach(r => {
      const tr = document.createElement('tr');
      const bits = prettyBits(r.ivs);
      tr.innerHTML = `<td class="mono">${r.ivs.join('/')}</td>
        <td class="mono muted">${bits}</td>
        <td class="mono">${r.cp20 || '—'}</td>
        <td class="mono">${r.cp25 || '—'}</td>`;
      tbody.appendChild(tr);
    });
    tbl.style.display = '';
  }

  function setStatus(msg, cls=''){ statusEl.textContent = msg; statusEl.className = 'status ' + cls; }

  async function fetchIvRows(slug){
    // Try JSON endpoint first
    const apiUrl = `https://db.pokemongohub.net/api/pokemon/${encodeURIComponent(slug)}/iv-chart`;
    try{
      const r = await fetch(apiUrl, { headers: { 'Accept':'application/json' } });
      if(r.ok){
        const data = await r.json();
        // Try to infer structure generically: look for array-ish property containing rows with IVs and CPs
        const candidates = Array.isArray(data) ? data : (Array.isArray(data?.rows) ? data.rows : (Array.isArray(data?.data) ? data.data : null));
        if(candidates){
          const rows = candidates
            .map(x => {
              // Try various keys defensively
              const pct = (x.percent ?? x.pct ?? x[0] ?? '').toString();
              const ivs = x.ivs || x.iv || x.stats || [x.atk, x.def, x.sta] || [];
              const raid = x.raid ?? x.raid_cp ?? x.cp_raid ?? x.cpRaid ?? x[3];
              const wthr = x.raid_weather ?? x.weather ?? x.cp_weather ?? x.cpWeather ?? x[4];
              return { pct, ivs: (ivs||[]).map(Number), cp20: raid? Number(String(raid).replace(/\D/g,'')) : null, cp25: wthr? Number(String(wthr).replace(/\D/g,'')) : null };
            })
            .filter(r => r.pct.startsWith('97.8%') && r.ivs.length===3);
          if(rows.length){ return rows; }
        }
      }
    }catch(e){ /* swallow and try HTML */ }

    // Fallback: fetch HTML and parse table
    const pageUrl = buildSourceUrl(slug);
    const htmlResp = await fetch(pageUrl, { credentials:'omit' });
    if(!htmlResp.ok){ throw new Error(`Failed to fetch GO Hub page (${htmlResp.status})`); }
    const html = await htmlResp.text();
    return parseIvRowsFromHtml(html);
  }

  function parseIvRowsFromHtml(html){
    const doc = new DOMParser().parseFromString(html, 'text/html');
    // Find the CP & IV table by header names
    let table = null;
    for(const t of doc.querySelectorAll('table')){
      const txt = t.textContent || '';
      if(/IVS/i.test(txt) && /Raid\/?Egg/i.test(txt) && /Raid \(Weather\)/i.test(txt)){ table = t; break; }
    }
    if(!table){ throw new Error('Could not locate IV/CP table in HTML'); }
    const rows = [];
    for(const tr of table.querySelectorAll('tbody tr')){
      const cells = Array.from(tr.querySelectorAll('td'));
      if(cells.length < 6) continue;
      const pct = cells[0].textContent.trim();
      if(!pct.startsWith('97.8%')) continue;
      const ivs = (cells[1].textContent.match(/\d+/g) || []).slice(0,3).map(Number);
      const cp20 = Number((cells[3].textContent.match(/\d{3,4}/)||[''])[0]);
      const cp25 = Number((cells[4].textContent.match(/\d{3,4}/)||[''])[0]);
      rows.push({ pct, ivs, cp20, cp25 });
    }
    if(!rows.length){ throw new Error('No 97.8% rows found in table'); }
    return rows;
  }

  async function generate(){
    outEl.value = ''; tbody.innerHTML=''; tbl.style.display='none'; $('#copy').disabled = true;
    const species = (speciesEl.value || '').trim();
    const slugInput = (slugEl.value || '').trim();
    if(!slugInput){ setStatus('Enter a GO Hub slug or Pokédex ID first (e.g., 888-Hero).', 'warn'); return; }

    // If user entered a bare ID like 888, try common forms until one works
    const isBareId = /^\d+$/.test(slugInput);
    const trySlugs = isBareId ? COMMON_FORMS.map(f => slugInput + f) : [slugInput];

    setStatus('Fetching CP & IV chart from GO Hub…');
    let rows = null, usedSlug = null, lastError = null;

    for(const s of trySlugs){
      try{
        rows = await fetchIvRows(s);
        usedSlug = s; break;
      }catch(err){ lastError = err; }
    }

    if(!rows){
      setStatus(`Failed to auto‑fetch. ${lastError? lastError.message : ''} Try the manual paste fallback below.`, 'err');
      srcLink.href = '#'; srcLink.setAttribute('disabled','true');
      return;
    }

    // Build output
    const include20 = inc20El.checked; const include25 = inc25El.checked; const dup = dupPrefixEl.checked;
    const search = genSegments(rows, species, include20, include25, dup);
    outEl.value = search;
    renderTable(rows);

    // Source link
    srcLink.href = buildSourceUrl(usedSlug);
    srcLink.removeAttribute('disabled');

    // UX goodies
    $('#copy').disabled = !search;
    const ivTriples = rows.map(r => r.ivs.join('/')).join(', ');
    const note = [];
    if(include20) note.push('L20'); if(include25) note.push('L25');
    setStatus(`OK · ${usedSlug} → 97.8% rows ${ivTriples} (${note.join(' + ')})`, 'ok');
  }

  $('#go').addEventListener('click', generate);
  $('#copy').addEventListener('click', async () => {
    try { await navigator.clipboard.writeText(outEl.value); setStatus('Copied to clipboard ✅', 'ok'); } catch(e){ setStatus('Could not copy (clipboard permission denied).', 'warn'); }
  });

  $('#parse').addEventListener('click', () => {
    const html = ($('#paste').value || '').trim();
    if(!html){ setStatus('Paste the GO Hub page HTML first.', 'warn'); return; }
    try{
      const rows = parseIvRowsFromHtml(html);
      const species = (speciesEl.value || '').trim();
      const include20 = inc20El.checked; const include25 = inc25El.checked; const dup = dupPrefixEl.checked;
      const search = genSegments(rows, species, include20, include25, dup);
      outEl.value = search; renderTable(rows);
      $('#copy').disabled = !search;
      setStatus('Parsed pasted HTML successfully ✅', 'ok');
    }catch(err){
      setStatus('Failed to parse pasted HTML: ' + err.message, 'err');
    }
  });

  // Demo defaults
  speciesEl.value = 'zacian';
  slugEl.value = '888-Hero';
  </script>
</body>
</html>